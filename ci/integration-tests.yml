---
platform: linux
image_resource:
  type: registry-image
  source:
    # this image contains a more recent version of docker to be able to install bitbucket
    # it has been built from https://gitlab.eng.vmware.com/esback/dcind
    repository: harbor-repo.vmware.com/fhamdi/dcind
    tag: 20.10.20-202211021203
inputs:
  - name: ytt
  - name: cypress-image
  - name: code
  - name: docker-image
  - name: bitbucket-image
params:
  DOCKER_CI_IMAGE: harbor-repo.vmware.com/esback/internal-instance
  GITLAB_TOKEN: ((gitlab_token))
  GITHUB_TOKEN: ((github_token))
  GITHUB_ENTERPRISE_TOKEN: ((github_enterprise_token))
  GIT_BRANCH: ((git_branch))
  BITBUCKET_SERVER_LICENSE: ((bitbucket_server_license))
  GKE_CONTROL_PLANE_ENDPOINT: ((gke_control_plane_endpoint))
  GKE_APP_LIVE_VIEW_ENDPOINT: ((gke_app_live_view_endpoint))
  GKE_SERVICE_ACCOUNT_TOKEN: ((gke_service_account_token))
  GKE_OIDC_CONTROL_PLANE_ENDPOINT: ((gke_oidc_control_plane_endpoint))
  GKE_OIDC_CLIENT_ID: ((gke_oidc_client_id))
  GKE_OIDC_CLIENT_SECRET: ((gke_oidc_client_secret))
  AUTH0_CLIENT_ID: ((auth0_client_id))
  AUTH0_CLIENT_SECRET: ((auth0_client_secret))
  AUTH0_DOMAIN: ((auth0_domain))
  CYPRESS_AUTH0_REFRESH_TOKEN: ((auth0_refresh_token))
  CYPRESS_GOOGLE_USER_A_REFRESH_TOKEN: ((google_user_a_refresh_token))
  CYPRESS_BITBUCKET_JOHN_DOE_REFRESH_TOKEN: ((bitbucket_john_doe_refresh_token))
run:
  dir: code
  path: ci/scripts/integration_tests
